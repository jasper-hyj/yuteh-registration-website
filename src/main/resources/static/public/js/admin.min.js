function getExcel(){var e=document.getElementById("form_select");document.getElementById("excel_link").href=`/admin/excel/download?id=${e.value}`}var i;function setAttributes(e,t){for(var n in t)e.setAttribute(n,t[n])}function openNewWin(e,t){window.open(e,t,"location=no,status=no,scrollvars=no")}function sendChangeMark(e){var t=document.getElementById(e+"markinput");console.log(t.value);const n=new XMLHttpRequest;var a=JSON.parse("{}");a.id=e,a.mark=t.value,a=JSON.stringify(a),n.addEventListener("load",function(t){var n=new bootstrap.Modal(document.getElementById(`modal${e}mark`),{keyboard:!1});document.querySelector(".modal-backdrop").remove(),n.hide(),searchData()}),n.addEventListener("error",function(e){alert(e.target.responseText)}),n.open("POST","/admin/mark/edit"),n.send(a)}function getForm(){document.getElementById("form_select");const e=new XMLHttpRequest,t=new FormData(viewFormForm);var n={};t.forEach((e,t)=>{Reflect.has(n,t)?(Array.isArray(n[t])||(n[t]=[n[t]]),n[t].push(e)):n[t]=e});var a=JSON.stringify(n);e.addEventListener("load",function(e){alert(e.target.responseText)}),e.addEventListener("error",function(e){alert(e.target.responseText)}),e.open("POST","/admin/form/view"),e.send(a)}var viewFormForm=document.getElementById("view_form_form");function searchData(){const e=new XMLHttpRequest,t=new FormData(searchForm);searchFieldset.disabled=!0;var n={};t.forEach((e,t)=>{Reflect.has(n,t)?(Array.isArray(n[t])||(n[t]=[n[t]]),n[t].push(e)):n[t]=e});var a=JSON.stringify(n);e.addEventListener("load",function(e){var t=JSON.parse(e.target.responseText),n=document.getElementById("searchResultTable");n.textContent="";var a=document.getElementById("resultCount");for(var r in a.innerText=`共${Object.keys(t).length}筆資料`,t){var s=document.createElement("tr");s.innerHTML=`\n                <td>${t[r].createTime}</td>\n                <td>${t[r].studentId}</td>\n                <td>${t[r].studentBirthDate}</td>\n                <td>${t[r].studentChineseName}</td>\n                <td>${t[r].mark}</td>\n                <td>\n                <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modal${t[r].UUID}mark">\n                更改註記\n                </button></td>\n                \n                <td>\n                <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modal${t[r].UUID}">\n                詳細資訊\n                </button></td>\n                <td>\n                <a href="javascript:openNewWin('/admin/edit?UUID=${t[r].UUID}', '更改')" class="btn btn-warning btn-sm">\n                更改\n                </a></td>`,n.appendChild(s);var d=document.createElement("div");setAttributes(d,{class:"modal fade",id:`modal${t[r].UUID}mark`,"data-bs-keyboard":"false",tabindex:"-1","aria-hidden":"true"}),d.innerHTML=`<div class="modal-dialog modal-dialog-centered">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title" id="exampleModalCenterTitle">更改註記</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <div class="modal-body">\n                            <input class="form-control form-control-sm" id="${t[r].UUID}markinput" value='${t[r].mark}' type="text">\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n                            <a href="javascript:sendChangeMark('${t[r].UUID}')" class="btn btn-warning">保存</a>\n                        </div>\n                    </div>\n                </div>`,n.appendChild(d);var o=document.createElement("div");setAttributes(o,{class:"modal fade",id:`modal${t[r].UUID}`,"data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-hidden":"true"});var l="";l+='\n                    <div class="modal-dialog  modal-lg">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h4 class="modal-title" id="staticBackdropLabel">詳細資料</h4>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                            </div>\n                            <div class="modal-body">\n                            \n                            ';var i=t[r].dataJSON,c=Object.keys(i);c.shift(),c.forEach((e,t)=>{var n=i[e],a=Object.keys(n),r=`<div><h3 class="fw-bold mt-3 ms-2">${e}</h3><table class="table"><tbody>`;a.forEach((e,t)=>{r+=`<tr><td style="width: 50%;">${e}</td><td>${JSON.stringify(n[e]).replace(/\"/g,"")}</td></tr>`}),l+=r+="</tbody></table></div>"}),l+='</div>\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-warning" data-bs-dismiss="modal">關閉</button>\n                </div></div></div>',o.innerHTML=l,n.appendChild(o)}searchFieldset.disabled=!1}),e.addEventListener("error",function(e){alert(e.target.responseText),searchFieldset.disabled=!1}),e.open("POST","/admin/search"),e.send(a)}null!=viewFormForm&&viewFormForm.addEventListener("submit",function(e){e.preventDefault(),getForm()});var searchForm=document.getElementById("searchForm"),searchFieldset=document.getElementById("searchFieldset");null!=searchForm&&searchForm.addEventListener("submit",function(e){e.preventDefault(),searchData()});const sqlForm=document.getElementById("sqlForm"),sqlString=document.getElementById("sqlString");var columnNameList=document.getElementById("columnNameList");const columnList=document.getElementById("columnList");if(null!=sqlForm){function sql(){sqlString.readOnly=!0;var e=new FormData(sqlForm);const t=new XMLHttpRequest;t.addEventListener("load",function(e){if(200==t.status){const t=JSON.parse(e.target.response);sqlString.readOnly=!1;var n=t.columnNameList;columnNameList.innerHTML='<th scope="col">#</th>',n.forEach(e=>{columnNameList.innerHTML+=`<th scope="col">${e}</th>`});var a=t.columns;columnList.innerHTML="";var r=1;a.forEach(e=>{var t=document.createElement("tr");t.innerHTML+=`<tr><th scope="row">${r}</th>`,e.forEach(e=>{t.innerHTML+=`<td>${e}</td>`}),columnList.appendChild(t),r+=1})}else alert(e.target.response),sqlString.readOnly=!1}),t.addEventListener("error",function(e){alert(e.target.responseText),console.log("ERROR : ",e.target.responseText),sqlString.readOnly=!1,alert(e.target.responseText.responseJSON.columnNameList[0])}),t.open("POST","/admin/sql/execute"),t.send(e)}document.onkeydown=function(e){e.ctrlKey&&"Enter"==e.code&&sql()},sqlForm.addEventListener("submit",function(e){e.preventDefault(),sql()},!0)}